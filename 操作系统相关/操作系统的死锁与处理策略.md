# 操作系统的死锁与处理策略

## 一、死锁的概念
&emsp;&emsp;**死锁**是指：在并发环境下，**进程因为资源竞争所造成的相互等待对方所占有的资源，导致各进程都阻塞的现象**。
## 二、 死锁产生的必要条件*
&emsp;&emsp;对进程不可剥夺的资源分配不当时会发生死锁，死锁的发生一定是满足以下四个条件：
 > 1. **互斥**：对互斥资源的争抢。
 > 2. **不可抢占**：进程在未使用完所占有的资源前，不能被其他进程抢占，只能主动释放。
 > 3. **请求和保持**：进程已经持有了至少一个资源，并提出新资源请求。
 > 4. **循环等待**：存在一种资源循环等待链，链中的每个进程所获的的资源同时被下个进程请求。
## 三、 死锁的处理策略*
&emsp;&emsp;死锁的处理策略主要有：**预防死锁**、**避免死锁**和**死锁检测与解除**
### 3.1 预防死锁
&emsp;&emsp;预防死锁的思想是通过**破坏死锁产生的四个必要条件中的某一个或某几个**来避免死锁的发生。
### 3.2 避免死锁
&emsp;&emsp;**安全序列**是指系统按照某种序列分配资源，并且每个进程都能顺序完成。只要存在安全序列，则系统就是**安全状态**。**如果系统处于安全状态，就一定不会发生死锁；如果系统进入不安全状态，就可能发生死锁**。因此，在每次资源分配之前预先判断这次分配是否会使系统进入不安全状态（本质是一个回溯算法，无法获得安全序列就让当前进程阻塞），以此决定是否响应这次资源分配请求（==银行家算法==的核心）。
### 3.3 死锁检测与解除
&emsp;&emsp;检测系统中是否存在死锁，使用死锁检测算法将资源分配图化简，仍然连着边的进程为死锁进程。
![简化后资源分配图](https://img-blog.csdnimg.cn/20210228145515707.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODgzNjI3Mw==,size_16,color_FFFFFF,t_70#pic_center=300x200)
&emsp;&emsp;在检测到死锁的发生后，可以利用以下方法进行解除：
 - **资源剥夺法**：将处于死锁中的某一线程挂起（暂时放入外存），并抢占其原先占有的资源。
 - **终止进程法**：强制撤销部分、甚至所有死锁进程，并剥夺这些进程的资源。
 - **进程回退法**：让一个或多个死锁进程回退到足以避免死锁的状态（要求操作系统能够记录进程快照）。
 
------
参考：《王道考研操作系统》
地址：https://www.bilibili.com/video/BV1YE411D7nH
